# 거래량 + 리베이트 중심 메이커 전략

## 개요

이 전략은 **거래량 극대화**와 **양방향 본절 거래**를 통한 **메이커 리베이트 획득**에 최적화된 알고리즘입니다.

## 핵심 로직

### 1. 양방향 동시 주문 배치
- **포지션 없을 때**: BUY와 SELL 주문을 동시에 배치하여 체결 기회 극대화
- **어느 한쪽이 체결되면** 즉시 포지션 관리 모드로 전환

### 2. 빠른 회전 (Quick Turnover)
- **최소 이익률**: 기본 0.01% (0.0001) - 리베이트가 이보다 클 경우 순이익
- 작은 이익으로도 빠르게 청산하여 거래 횟수 증가
- 거래 횟수 증가 = 리베이트 수익 증가

### 3. 포지션 누적을 통한 거래량 유지
- 포지션 보유 중에도 **동일 방향 추가 주문** 배치
- 최대 포지션 크기: `tradeAmount × maxPositionMultiple` (기본 3배)
- 청산 주문과 진입 주문을 동시에 유지하여 연속적인 거래량 생성

### 4. 리베이트 우선 손절 전략
- **일반 전략보다 넓은 손절폭**: `lossLimit × volumeBasedLossMultiple` (기본 2배)
- 손실이 확대되는 경우에만 보호적 손절 주문 배치
- 작은 손실은 리베이트로 상쇄 가능

## 설정 파라미터

### 환경변수 설정

```bash
# 기본 거래 설정
TRADE_AMOUNT=0.001                    # 거래 단위 (BTC 등)
MAKER_BID_OFFSET=0                    # BID 주문 오프셋 (0 = 최우선호가)
MAKER_ASK_OFFSET=0                    # ASK 주문 오프셋 (0 = 최우선호가)

# 리베이트 최적화 파라미터
MAKER_MAX_POSITION_MULTIPLE=3         # 최대 포지션 누적 배수
MAKER_MIN_TAKE_PROFIT_PCT=0.0001      # 최소 익절 비율 (0.01%)
MAKER_REBATE_RATE=0.00005             # 예상 메이커 리베이트율 (-0.005%)
MAKER_VOLUME_LOSS_MULTIPLE=2          # 거래량 우선시 손절폭 배수

# 손절 설정
MAKER_LOSS_LIMIT=0.03                 # 기본 손절폭 (3%)
# 실제 적용되는 손절폭 = 0.03 × 2 = 6%
```

### 주요 파라미터 설명

#### `maxPositionMultiple` (기본: 3)
- 포지션을 최대 몇 배까지 누적할 것인가
- 높을수록 거래량 증가, 위험도 증가
- 권장 범위: 2~5

#### `minTakeProfitPct` (기본: 0.0001 = 0.01%)
- 최소 익절 비율
- 리베이트율보다 낮게 설정하면 순이익
- 예: 리베이트 0.005%일 때, 0.01% 익절시 총 0.015% 수익

#### `makerRebateRate` (기본: 0.00005 = -0.005%)
- 거래소의 메이커 리베이트율
- 거래량 트래커가 예상 리베이트 수익 계산시 사용
- 거래소별로 다르므로 확인 후 설정

#### `volumeBasedLossMultiple` (기본: 2)
- 기본 손절폭의 몇 배로 설정할 것인가
- 거래량 증대를 위해 손절을 늦춤
- 주의: 너무 높으면 큰 손실 가능

## 수익 모델

### 예상 수익 계산

거래량 기반 수익:
```
리베이트 수익 = 거래량 × 리베이트율

예시:
- 일일 거래량: $100,000
- 리베이트율: -0.005%
- 일일 리베이트 수익: $100,000 × 0.00005 = $5
```

### 전략 장점

1. **거래 횟수 극대화**
   - 양방향 주문 → 빠른 익절 → 재진입
   - 높은 회전율로 리베이트 수익 증대

2. **연속적인 거래량 생성**
   - 포지션 보유 중에도 추가 진입
   - 청산 대기 중에도 새 진입 기회 포착

3. **리베이트로 손실 상쇄**
   - 작은 손실은 리베이트로 커버
   - 넓은 손절폭으로 불필요한 손절 방지

### 전략 단점 및 리스크

1. **포지션 누적 위험**
   - 한 방향으로 계속 체결시 큰 포지션
   - `maxPositionMultiple`로 제한 필요

2. **급격한 시장 변동에 취약**
   - 넓은 손절폭으로 인한 큰 손실 가능
   - 변동성 높은 시장에서는 파라미터 조정 필요

3. **거래소 의존성**
   - 리베이트율은 거래소 정책에 따라 변경 가능
   - VIP 레벨, 거래량 조건 등 확인 필요

## 모니터링

### 세션 거래량 트래커

업데이트된 `SessionVolumeTracker`는 다음을 추적합니다:

- `value`: 총 거래량 (USD 기준)
- `count`: 거래 횟수
- `estimatedRebate`: 예상 리베이트 수익

UI에서 실시간으로 확인 가능합니다.

## 적용 전략

- `maker-engine.ts`: 일반 메이커 전략
- `grvt-maker-engine.ts`: GRVT 거래소 전용 메이커 전략

두 전략 모두 동일한 로직을 사용합니다.

## 사용 예시

### 1. 환경 설정
```bash
# .env 파일
TRADE_AMOUNT=0.01
MAKER_BID_OFFSET=0
MAKER_ASK_OFFSET=0
MAKER_MAX_POSITION_MULTIPLE=3
MAKER_MIN_TAKE_PROFIT_PCT=0.0001
MAKER_REBATE_RATE=0.00005
MAKER_VOLUME_LOSS_MULTIPLE=2
MAKER_LOSS_LIMIT=0.03
```

### 2. 전략 실행
```bash
bun run index.ts
# 메뉴에서 Maker 전략 선택
```

### 3. 모니터링
- 거래량 누적 확인
- 예상 리베이트 수익 확인
- 거래 횟수 모니터링
- 포지션 크기 관리

## 최적화 팁

### 거래량 극대화
- `bidOffset`, `askOffset`을 0으로 설정 (최우선호가)
- `maxPositionMultiple` 증가 (위험 감수)
- `minTakeProfitPct` 감소 (더 빠른 청산)

### 리스크 관리
- `maxPositionMultiple` 감소
- `volumeBasedLossMultiple` 감소 (더 빠른 손절)
- 변동성 높은 시간대 피하기

### 수익성 개선
- VIP 레벨 업그레이드로 리베이트율 증가
- 유동성 높은 페어 선택
- 거래소별 리베이트 프로그램 확인

## 참고사항

- 거래소의 메이커/테이커 수수료 정책을 반드시 확인하세요
- 일부 거래소는 거래량 조건이 있을 수 있습니다
- 리베이트율은 실시간으로 변경될 수 있습니다
- 백테스팅 결과와 실제 결과는 다를 수 있습니다
